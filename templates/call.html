{% extends "base.html" %}

{% block title %}AI Call Testing - {{ super() }}{% endblock %}

{% block content %}
<div class="min-h-screen py-8" x-data="callTester()">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">AI Call Tester</h1>
        <p class="text-gray-600">Test the AI calling system with continuous conversation</p>
        
        <!-- Health Status -->
        <div class="mt-4 flex items-center space-x-4">
            <div class="flex items-center">
                <div class="bg-green-500 w-3 h-3 rounded-full mr-2"></div>
                <span class="text-sm text-gray-600">System Active</span>
            </div>
            <div class="flex items-center">
                <div class="bg-blue-500 w-3 h-3 rounded-full mr-2"></div>
                <span class="text-sm text-gray-600">Ready to Call</span>
            </div>
        </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
        <!-- Call Testing Panel -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Make Test Call</h2>
            
            <form @submit.prevent="makeCall()" class="space-y-4">
                <div>
                    <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-2">
                        Phone Number (with country code)
                    </label>
                    <input 
                        type="tel" 
                        id="phoneNumber"
                        x-model="phoneNumber"
                        placeholder="+1234567890"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required
                    >
                    <p class="text-xs text-gray-500 mt-1">Use your own number for testing</p>
                </div>
                
                <button 
                    type="submit"
                    :disabled="calling"
                    :class="calling ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'"
                    class="w-full text-white font-medium py-2 px-4 rounded-md transition duration-200"
                >
                    <span x-show="!calling">üìû Make Test Call</span>
                    <span x-show="calling">üìû Calling...</span>
                </button>
            </form>

            <!-- Call Status -->
            <div x-show="lastCall" class="mt-6 p-4 bg-gray-50 rounded-md">
                <h3 class="text-sm font-medium text-gray-800 mb-2">Call Status</h3>
                <div x-show="lastCall?.success" class="text-green-600 text-sm">
                    ‚úÖ Call initiated successfully
                    <br>Call SID: <span x-text="lastCall?.call_sid" class="font-mono text-xs"></span>
                </div>
                <div x-show="lastCall && !lastCall?.success" class="text-red-600 text-sm">
                    ‚ùå Call failed: <span x-text="lastCall?.error"></span>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-6 p-4 bg-blue-50 rounded-md">
                <h3 class="text-sm font-medium text-blue-800 mb-2">üìã Test Instructions</h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>1. Enter your phone number</li>
                    <li>2. Click "Make Test Call"</li>
                    <li>3. Answer when your phone rings</li>
                    <li>4. Talk to Sarah (AI assistant)</li>
                    <li>5. Test different responses</li>
                </ul>
            </div>
        </div>

        <!-- Call Features -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">AI Features Being Tested</h2>
            
            <div class="space-y-4">
                <div class="flex items-start space-x-3">
                    <div class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">
                        ‚úì Continuous Conversation
                    </div>
                </div>
                <p class="text-sm text-gray-600">AI maintains context throughout the entire call</p>
                
                <div class="flex items-start space-x-3">
                    <div class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">
                        ‚úì Natural Speech Recognition
                    </div>
                </div>
                <p class="text-sm text-gray-600">Understands and responds to natural speech</p>
                
                <div class="flex items-start space-x-3">
                    <div class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">
                        ‚úì Job Opportunity Pitch
                    </div>
                </div>
                <p class="text-sm text-gray-600">Presents job details and gauges interest</p>
                
                <div class="flex items-start space-x-3">
                    <div class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">
                        ‚úì Smart Call Ending
                    </div>
                </div>
                <p class="text-sm text-gray-600">Knows when to end conversation naturally</p>
            </div>

            <!-- Test Scenarios -->
            <div class="mt-6 p-4 bg-yellow-50 rounded-md">
                <h3 class="text-sm font-medium text-yellow-800 mb-2">üí° Try These Responses</h3>
                <ul class="text-sm text-yellow-700 space-y-1">
                    <li>‚Ä¢ "Yes, I'm interested"</li>
                    <li>‚Ä¢ "Tell me more about the job"</li>
                    <li>‚Ä¢ "What's the pay rate?"</li>
                    <li>‚Ä¢ "Not interested, thanks"</li>
                    <li>‚Ä¢ "Can you call me back later?"</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Back to Dashboard -->
    <div class="mt-8 text-center">
        <a href="{{ url_for('index') }}" class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition duration-200">
            ‚Üê Back to Dashboard
        </a>
    </div>
</div>

<script>
    function callTester() {
        return {
            phoneNumber: '',
            calling: false,
            lastCall: null,
            
            async makeCall() {
                if (!this.phoneNumber.trim()) {
                    alert('Please enter a phone number');
                    return;
                }
                
                this.calling = true;
                this.lastCall = null;
                
                try {
                    const response = await fetch('/make_test_call', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            phone_number: this.phoneNumber
                        })
                    });
                    
                    const result = await response.json();
                    this.lastCall = result;
                    
                } catch (error) {
                    this.lastCall = {
                        success: false,
                        error: error.message
                    };
                } finally {
                    this.calling = false;
                }
            }
        }
    }
</script>
{% endblock %}
